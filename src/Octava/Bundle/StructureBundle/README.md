# Модуль Структура

## Задачи модуля
1. Предоставить возможность создавать структуру ссылок сайта из интерфейса админки
2. Предоставить возможность создания и редактирования страниц расположенных по произвольным адресам
3. Предоставить возможность подключить функционал модулей с выводом на фронтенде к произвольному узлу
4. Предоставить разработчикам интерфейс для регистрации функционала их модулей с учётом произвольного
расположения в структуре ссылок


## Основные понятия
1\. Структура узлов реализована ввиде дерева. Ссылка которую представляет узел строится из алиаса данного узла
и всех предыдущих узлов начиная с корневого. Ссылка не содержит знак `/` в конце.

2\. У каждого узла есть `Тип содержания` данного узла. Базовым типом является `Страница`. Данный тип представляет
собой обычную страницу в дизайне сайта с возможностью редактирования заголовка и текста.
Другие типы регистрируются бандлами с помощью отдельного механизма описанного ниже.

3\. Каждый узел предоставляет возможность редактирования заголовка и описания. Для типа `Страница` данные поля
используются как основные. Для других типов заголовок будет использоваться всегда, в то время как использование
описания может быть необязательным.


## Подключение функционала бандлов к виртуальной структуре
Для подключения отдельных частей функциоала используется стандартный механизм Symfony с обёрткой модуля Структуры.

Например, нам нужно подключить список новостей с карточкой. Для этого:
1\. Пропишем в файле app/config/routing.yml

```yml
news:
    resource: "@NewsBundle/Resources/config/routing.yml"
    prefix:   /
    type: robo_structure
```

Таким образом подключается стандартная конфигурация рутинга бандла NewsBundle. Нестандартным является
указание типа `robo_structure`. Данный тип влючает обработку файла конфига специальным загрузчиком модуля Структуры.

2\. В файле `NewsBundle/Resources/config/routing.yml` пропишем стандартные пути с учётом подключения к структуре

```yml
news_list:
    pattern:  /{page}
    defaults: { _controller: RoboNewsBundle:Default:index, page: 1 }

news_show:
    pattern:  %news_list.path%/show/{id}
    defaults: { _controller: RoboNewsBundle:Default:show}
```

Разберём по-очереди пути.

Путь `news_list` сконфигурирован так будто он должен работать от корня сайта. Это сделано специально с учётом
того, что в начало данного пути будет добавлен путь узла структуры к которому будет привязан данный функционал.
Таким же образом конфигурируются все пути которые могут быть привязаны к узлам структуры. При этом работают все
стандартные возможности конфигурации - плейсхолдеры, задание хоста, схемы и обязательные параметры.

Путь `news_show` в паттерне соддержит переменную, которая указывает, что данный путь является зависимым от другого
пути и должен быть подключен к тому же узлу, что и указанный путь в переменной.
Вид переменной должен соответствовать ``%<other_route_name>.path%``
В результате данный рутинг не будет показан в списке модулей для подключения в форме редактирования узла структуры,
но при этом будет включен автоматически при подключении к узлу структуры рутинга `news_list`.

Например, если мы привязали рутинг `news_list` через админку модуля Структура к узлу с путём `/about/news`,
то будут доступны следующие пути:

1. `/about/news` - первая страница новостей
2. `/about/news/2` - вторая страница новостей
3. `/about/news/show/1` - страница карточки новости с ID=1

## Перевод названий рутингов

Перевод для вывода в селекбоксе в форме редактирования модуля Структура осуществляется в рамках
домена `RoboStructureBundle`. Алиас для перевода аналогичен названию рутинга. Таким образом для перевода
названия рутинга из примера выше нужно создать языковые файлы со следующим содержанием.

```yml
#NewsBundle/Resources/translations/RoboStructureBundle.en.yml
news_list: News list
```

## Параметры

`default_template` - Шаблон по умолчанию. Если не задан, то берется `RoboStructureBundle:Default:id.html.twig`.
`additional_templates` - Дополнительные шаблоны. Перевод названий шаблонов берется из домена RoboStructureBundle 

Пример:

```yml
robo_structure:
    default_template: 'AppFrontBundle:Structure:default.html.twig' # Шаблон по умолчанию
    additional_templates: # Дополнительные шаблоны
        template_no_right_menu: 'AppFrontBundle:Structure:without_right_menu.html.twig'
```